# Descomente a linha abaixo para o uso em Valgrind.
# p.s.: O modo debug(DBG) deve estar ativado.
#CPPFLAGS= -fno-inline

ifeq "$(TEC_UNAME)" "SunOS510_64"
  USE_CC=Yes
  AR= CC
  
  ifeq "$(DBG)" "YES"
    CPPFLAGS= -g
    STDLFLAGS= -g
    LFLAGS= -g
  endif

  CPPFLAGS+= -erroff=badargtype2w -m64 -library=stlport4
  STDLFLAGS+= -m64 -xar -o  
  LFLAGS+= -m64 -library=stlport4 
  LIBS= nsl socket
  NO_LOCAL_LD=Yes

  ifeq "$(MULTITHREAD)" "Yes"
    CPPFLAGS+= -mt
    LFLAGS+= -mt
    STDLFLAGS= -mt -m64 -xar -o
  endif
endif

OPENBUSINC = ${OPENBUS_HOME}/include
OPENBUSLIB = ${OPENBUS_HOME}/lib

ifeq "$(DBG)" "Yes"
  LIB_DEBUG=-debug
endif

ifeq "$(OPENBUS_SDK_MULTITHREAD)" "Yes"
  MICO_BIN= ${MICODIR}/bin/mico-${MICOVERSION}-multithread$(LIB_DEBUG)
  MICO_INC= ${OPENBUS_HOME}/include/mico-${MICOVERSION}-multithread$(LIB_DEBUG)
  MICO_LIB= ${OPENBUS_HOME}/lib/mico-${MICOVERSION}-multithread$(LIB_DEBUG)
  DEFINES+=OPENBUS_SDK_MULTITHREAD
  DEFINES+=SCS_THREADING_ENABLED
  DEFINES+=LOGGER_MULTITHREAD
  LIBS+=pthread
else
  MICO_BIN= ${MICODIR}/bin/mico-${MICOVERSION}-singlethread
  MICO_INC= ${OPENBUS_HOME}/include/mico-${MICOVERSION}-singlethread
  MICO_LIB= ${OPENBUS_HOME}/lib/mico-${MICOVERSION}-singlethread
endif

INCLUDES= . \
  ../../util \
  ../stubs \
  ${MICO_INC} \
  ${OPENBUSINC}/openbus/cpp \
  ${OPENBUSINC}/openbus/cpp/stubs/mico \
  ${OPENBUSINC} \
  ${OPENBUSINC}/logger \
  ${OPENBUSINC}/cxxtest
    
AUXILIAR_SRC= ../util/auxiliar.cpp

LDIR= ${OPENBUSLIB} ${MICO_LIB}

LIBS+= mico${MICOVERSION} dl crypto ssl

ifeq "$(OPENBUS_SDK_MULTITHREAD)" "Yes"
  SLIB= ${OPENBUSLIB}/libopenbus-micomultithread$(LIB_DEBUG).a \
        ${OPENBUSLIB}/libscs-micomultithread$(LIB_DEBUG).a \
        ${OPENBUSLIB}/liblogger-multithread$(LIB_DEBUG).a
else
  SLIB= ${OPENBUSLIB}/libopenbus-micosinglethread$(LIB_DEBUG).a \
        ${OPENBUSLIB}/libscs-micosinglethread$(LIB_DEBUG).a \
        ${OPENBUSLIB}/liblogger-singlethread$(LIB_DEBUG).a
endif

USE_LUA51= YES
USE_NODEPEND= Yes

OBJROOT= obj
TARGETROOT= bin

STUBS= ../stubs/RGSTest.h ../stubs/RGSTest.cc

IDLS: ../idl/RGSTest.idl

$(STUBS): $(IDLS)
	mkdir -p ../stubs
	cd ../stubs ; ${MICO_BIN}/idl --poa ../../idl/RGSTest.idl

genstubs: $(STUBS)
